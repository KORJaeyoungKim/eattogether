<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <title>스파르타 피디아</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        font-family: "Gowun Dodum", sans-serif;
        box-sizing: border-box;
      }

      #page-logo {
        display: flex;
        align-items: center;
      }

      #page-logo img {
        width: 70px;
        height: 70px;
        margin-right: 8px;
      }

      #page-logo #logo-title {
        font-size: 3rem;
        font-weight: 600;
        color: #4b6587;
      }

      body {
        background-color: #f0e5cf;
      }

      header {
        position: sticky;
        top: 0;
        height: 100px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
        margin: 0 auto;
        min-width: 1030px;
        max-width: 1200px;
        border-bottom: 8px double #4b6587;
        background-color: #f0e5cf;
        z-index: 1000;
      }

      #page-logo #logo-title {
        font-size: 3rem;
        font-weight: 600;
        color: #4b6587;
      }

      #logout-btn button {
        height: 80px;
        color: #4b6587;
        font-size: 2.6rem;
        letter-spacing: 0.2rem;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 400;
        background-color: #f0e5cf;
        border: none;
      }

      #logout-btn button:hover {
        -webkit-animation: tracking-in-expand 0.7s
          cubic-bezier(0.215, 0.61, 0.355, 1) both;
        animation: tracking-in-expand 0.7s cubic-bezier(0.215, 0.61, 0.355, 1)
          both;
      }
      @-webkit-keyframes tracking-in-expand {
        0% {
          letter-spacing: -0.6em;
          opacity: 0;
        }
        40% {
          opacity: 0.6;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes tracking-in-expand {
        0% {
          letter-spacing: -0.5em;
          opacity: 0;
        }
        40% {
          opacity: 0.6;
        }
        100% {
          opacity: 1;
        }
      }

      #username button {
        height: 80px;
        color: #4b6587;
        font-size: 2.6rem;
        letter-spacing: 0.2rem;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 400;
        background: none;
        border: none;
      }

      #wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 95%;
        width: 1030px;
        min-width: 1030px;
        margin: 0 auto;
      }

      #recruit-section {
        margin: 25px 0 20px 0;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        align-items: center;
        max-width: 95%;
        width: 1030px;
        min-width: 1030px;
        height: 200px;
      }

      #recruit-section .input-group {
        height: 60px;
        margin-bottom: 20px;
      }

      #recruit-section .input-group input {
        color: #4b6587;
        font-size: 1.3rem;
      }

      #recruit-section .input-group input::placeholder {
        color: #4b6587;
        font-size: 1.3rem;
      }
      #warningMsg {
        font-size: 1.2rem;
        letter-spacing: 0.1rem;
        color: #eb4747;
        padding-bottom: 8px;
      }
      .form-control {
        background-color: #f7f6f2;
        color: #4b6587;
      }

      .card-title {
        color: #4b6587;
        font-weight: 400;
        font-size: 1.5rem;
        letter-spacing: 0.1rem;
        padding-bottom: 4px;
        border-bottom: 1px solid #4b6587;
      }

      #recruit-btn {
        width: 500px;
        height: 60px;
        font-size: 1.4rem;
        letter-spacing: 0.3rem;
        color: #f7f6f2;
        background-color: #4b6587;
        border: 5px solid #f7f6f2;
        box-shadow: 0 0 0 6px #4b6587;
        border-radius: 5px;
      }

      #card-section {
        border-radius: 6px;
      }

      #card-section .row {
        padding: 8px;
        background: none;
      }

      .col,
      .card {
        width: 330px;
        height: 330px;
      }

      .col {
        position: relative;
        padding: 0;
        margin: 8px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2),
          0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }

      .card-body {
        background-color: #f7f6f2;
        padding: 8px 16px 0 16px;
      }

      .card-title {
        padding-bottom: 4px;
        border-bottom: 1px solid #4b6587;
      }

      .hover-layer {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.6);
        z-index: 999;
        opacity: 0;
        transition: all 0.3s;
      }

      .bottom-container p span {
        font-size: 1.3rem;
        letter-spacing: 0.2rem;
      }

      .bottom-container .people-stat {
        width: 90px;
        height: 90px;
        margin-top: 5px;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        font-size: 1.5rem;
        background-color: #c8c6c6;
        border-radius: 0 0 6px 0;
      }

      .col:hover .hover-layer {
        opacity: 1;
      }

      .hover-btn {
        width: 296px;
        color: #f7f6f2;
        background-color: #4b6587;
        padding: 10px 0;
        border-radius: 6px;
        font-size: 1.9rem;
        letter-spacing: 0.2rem;
        position: absolute;
        top: 50%;
        left: 50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        text-align: center;
      }

      .container {
        position: relative;
        padding: 0;
        width: 296px;
        height: 180px;
        border-radius: 6px 6px 0 0;
      }

      .container img {
        width: 296px;
        height: 180px;
        border-radius: 6px 6px 0 0;
      }

      .container .place-name {
        position: absolute;
        bottom: 0;
        width: 296px;
        background-color: rgba(0, 0, 0, 0.65);
        color: #f7f6f2;
        text-align: center;
        font-size: 1.3rem;
      }

      .bottom-container {
        display: flex;
        width: 296px;
      }

      .bottom-container p {
        width: 200px;
        height: 90px;
        text-align: justify;
        font-size: 1.1rem;
        margin: 5px 5px 5px 0;
        padding: 4px;
        padding-left: 10px;
        background-color: #c8c6c6;
        border-radius: 0 0 0 6px;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
      }

      .bottom-container .people-stat {
        width: 90px;
        height: 90px;
        margin-top: 5px;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        font-size: 1.5rem;
        background-color: #c8c6c6;
        border-radius: 0 0 6px 0;
      }

      .img-fluid {
        height: 400px;
        width: 100%;
      }

      .place {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .display-3 {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 80px;
        background-color: white;
        width: 90%;
      }

      .host {
        padding-left: 50px;
      }

      .guest {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
      }

      .field {
        background-color: #e2e2e2;
        width: 700px;
        margin: auto;
        height: 100%;
      }

      .detailcard {
        margin: 5px;
        border: 1px solid black;
      }

      /* 로딩모달창 관련 스타일 */
      #staticBackdrop .modal-body {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
      }
      #staticBackdrop .btn-close {
        display: none;
      }
      .loader {
        border: 10px solid #f7f6f2;
        border-radius: 50%;
        border-top: 10px solid #4b6587;
        width: 60px;
        height: 60px;
        -webkit-animation: spin 1.5s ease infinite; /* Safari */
        animation: spin 1.5s ease infinite;
        margin-bottom: 10px;
      }

      /* Safari */
      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      $(document).ready(function () {
        resetInput();
        renderCard();
      });

      function DataSend(idx) {
        $("#detailCard").empty();
        console.log("idx", idx);
        $.ajax({
          type: "GET",
          url: "/DataSend",
          data: { index_give: idx },
          success: function (response) {
            let info = response.cards;
            console.log("rows", info);
            let temp_html = `  <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">카드 상세보기</h5>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                ></button>
            </div>
            <div class="modal-body" >
                <div class="field">
                    <img
                            src="${info.img}"
                            class="img-fluid"
                            alt="..."
                    />
                    <div class="place">
                        <h4 class="display-3">${info.place}</h4>
                    </div>
                    <h4 class="host">방장 : OOO(잔여 인원 : 00명)</h4>
                    <div class="guest">
                        {% for i in range(10) %}
                            <div class="detailcard" style="width: 18rem">
                                <div class="card-body">
                                    <h5 class="card-title">신청자 : OOO</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">010-0000-0000</h6>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                >
                    Close
                </button>
                <button onclick="join(${info.index})" type="button" class="btn btn-primary">
                    신청하기
                </button>
            </div>`;
            $("#detailCard").append(temp_html);
          },
        });
      }

      function renderCard() {
        $.ajax({
          type: "GET",
          url: "/posts",
          data: {},
          success: function (response) {
            let row = response.cards;
            row.forEach((element) => {
              let title = element.title;
              let img = element.img;
              let place = element.place;
              let people = element.people;
              let time = element.time;

              let cardHtml = `
                <div class="col" onclick="DataSend(${element.index})">
                  <div
                    class="hover-layer"
                    data-bs-toggle="modal"
                    data-bs-target="#exampleModal"
                  >
                  <span class="hover-btn">신청하러 가기!</span>
                  </div>
                  <div class="card text-center">
                    <div class="card-body">
                      <h5 class="card-title">${title}</h5>
                      <div class="container">
                        <img src='${img}' alt='가게사진' />
                        <div class="place-name">${place}</div>
                      </div>
                      <div class="bottom-container">
                        <p class="card-text">
                          <span>모임시간</span>
                          <span>${time}</span>
                        </p>
                        <div class="people-stat">
                          <img src="" alt="icon" />
                          3/${people}
                        </div>
                      </div>
                    </div>
                  </div>
              `;
              $(".row").append(cardHtml);
            });
          },
        });
      }

      function resetInput() {
        for (i = 0; i <= 3; i++) {
          let input = $(".input-group input")[i].value;
          if (input != "") {
            $(".input-group input")[i].value = "";
          } else if (input == "") {
            continue;
          }
        }
      }

      function listing() {
        $.ajax({
          type: "GET",
          url: "/movie",
          data: {},
          success: function (response) {},
        });
      }

      function cardPosting() {
        let title = $("#title-input").val();
        let place = $("#place-input").val();
        let people = $("#people-input").val();
        let time = $("#time-input").val();
        let userToken = document.cookie;
        if (title == "" || place == "" || people == "" || time == "") {
          if ($("#warningMsg")[0] == undefined) {
            setTimeout(function () {
              let warningMsg = document.createElement("span");
              warningMsg.appendChild(
                document.createTextNode("모임 정보를 모두 입력해주세요!")
              );
              $("#recruit-section")[0].insertBefore(
                warningMsg,
                $("#recruit-btn")[0]
              );
              $("#recruit-section > span")[0].setAttribute("id", "warningMsg");
            }, 600);
          }

          setTimeout(function () {
            console.log("Executed after 1 second");
            $("#staticBackdrop .btn-close").trigger("click");
          }, 500);
          return;
        }
        $.ajax({
          type: "POST",
          url: "/posts",
          data: {
            title_give: title,
            place_give: place,
            people_give: people,
            time_give: time,
          },
          success: function (response) {
            $("#staticBackdrop .modal-body span")[0].textContent = response.msg;
            setTimeout(() => window.location.reload(), 400);
          },
        });
      }

      function close_card() {}

      function numberMaxLength(e) {
        if (e.value.length > e.maxLength) {
          e.value = e.value.slice(0, e.maxLength);
        }
      }
      function sign_out() {
        $.removeCookie("mytoken", { path: "/" });
        alert("로그아웃!");
        window.location.href = "/login";
      }

      //모임신청을 위한 버튼함수
      function join(idxNum) {
        $.ajax({
          type: "POST",
          url: "/join",
          data: { number: idxNum },
          success: function (response) {
            console.log(response["msg"]);
            alert(response["msg"]);
            window.location.reload();
          },
        });
      }
    </script>
  </head>

  <body>
    <header>
      <div id="page-logo">
        <img src="../static/small-icon.png" alt="logo" />
        <span id="logo-title"> 밥먹자 </span>
      </div>
      <div id="logout-btn">
        <button onclick="sign_out()">
          <span>&lt;</span>/Logout<span>&gt;</span>
        </button>
      </div>

      <div id="username">
        <button onclick="window.location.href='/signup'">
          <span>&lt;</span>Login first<span>&gt;</span>
        </button>
      </div>
    </header>
    <div id="wrap">
      <div id="recruit-section">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            placeholder="제목(최대12자)"
            aria-label="title"
            id="title-input"
            maxlength="12"
            oninput="numberMaxLength(this)"
          />
          <input
            type="text"
            class="form-control"
            placeholder="상호명(최대15자)"
            aria-label="place-name"
            id="place-input"
            maxlength="15"
            oninput="numberMaxLength(this)"
          />
          <input
            type="number"
            class="form-control"
            placeholder="인원수"
            aria-label="people"
            id="people-input"
          />
          <input
            type="text"
            class="form-control"
            placeholder="모임시간"
            aria-label="meet-time"
            id="time-input"
          />
        </div>
        <button
          id="recruit-btn"
          onclick="cardPosting()"
          data-bs-toggle="modal"
          data-bs-target="#staticBackdrop"
        >
          인원 모집하기
        </button>
      </div>
      <div id="card-section">
        <div class="row row-cols-3 row-cols-md-3"></div>
      </div>
    </div>
    <div
      class="modal fade"
      id="staticBackdrop"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-dialog-sm">
        <div class="modal-content">
          <div class="modal-body">
            <div class="loader"></div>
            <span>잠시만 기다려주세요!</span>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" id="detailCard"></div>
      </div>
    </div>
  </body>
</html>
